{% extends "admin/_base.html" %}
{% load static %}

{% block content %}

{% include 'componentes/banner.html' %}

<form method="GET" class="flex w-full items-center space-x-2 py-3">
    <div class="relative w-full">
        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                fill="none" viewBox="0 0 20 20">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
            </svg>
        </div>
        <input type="search" id="default-search" name="q"
            class="block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-gray-500 focus:border-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
            placeholder="Buscar mensajes..." value="{{ query }}" />
    </div>
    <button type="submit"
        class="text-white cursor-pointer bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-3 py-2.5">Buscar</button>
</form>

<ul class="flex flex-col w-full justify-center items-center py-1">
    {% for mensaje in pagina_actual %}
        <li class="w-full p-4 mb-2 rounded-lg shadow 
            {% if not mensaje.leido %}
                bg-yellow-50 border-l-4 border-yellow-400
            {% else %}
                bg-white dark:bg-gray-800
            {% endif %}
        ">
            <div class="flex justify-between items-center">
                <div>
                    <p class="font-bold text-gray-900 dark:text-white">{{ mensaje.nombre_completo }}</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">{{ mensaje.correo }} | {{ mensaje.numero_whatsapp }}</p>
                    <p class="text-gray-700 dark:text-gray-300 mt-1">{{ mensaje.mensaje|truncatechars:100 }}</p>
                    <p class="text-xs text-gray-400 mt-1">{{ mensaje.fecha_creacion|date:"d/m/Y H:i" }}</p>
                </div>
                <div class="flex items-center space-x-2">
                    {% if not mensaje.leido %}
                    <a href="{% url 'marcar_mensaje_leido' mensaje.id %}" 
                       class="text-blue-600 hover:underline">Marcar como leído</a>
                    {% else %}
                    <span class="text-gray-500">Leído</span>
                    {% endif %}
                    <a href="{% url 'eliminar_mensaje' mensaje.id %}" 
                       onclick="return confirm('¿Deseas eliminar este mensaje?');"
                       class="text-red-600 hover:underline">Eliminar</a>
                </div>
            </div>
        </li>
    {% empty %}
        <li class="text-gray-500 font-bold py-3">No hay mensajes disponibles.</li>
    {% endfor %}
</ul>

{% if total_registros > 0 %}
<div class="flex w-full p-3 justify-center items-center">
    <nav aria-label="Page navigation example">
        <ul class="inline-flex -space-x-px text-sm">
            {% if pagina_actual.has_previous %}
            <li>
                <a href="?q={{ query }}&page={{ pagina_actual.previous_page_number }}"
                    class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-700 bg-white border border-e-0 border-gray-300 rounded-s-lg">
                    Anterior
                </a>
            </li>
            {% else %}
            <li>
                <span
                    class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg">Anterior</span>
            </li>
            {% endif %}

            <li>
                <span class="flex items-center justify-center px-3 h-8 text-gray-500 border border-gray-300">
                    Página: {{ pagina_actual.number }} </span>
            </li>

            {% if pagina_actual.has_next %}
            <li>
                <a href="?q={{ query }}&page={{ pagina_actual.next_page_number }}"
                    class="flex items-center justify-center px-3 h-8 leading-tight text-gray-700 bg-white border border-gray-300 rounded-e-lg">
                    Siguiente
                </a>
            </li>
            {% else %}
            <li>
                <span
                    class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg">Siguiente</span>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endif %}

{% endblock content %}
