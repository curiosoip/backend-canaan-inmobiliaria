{% extends "admin/_base.html" %}
{% load static %}

{% block content %}

{% include 'componentes/banner.html' %}

<!-- Buscador de mensajes -->
<form method="GET" class="flex w-full items-center space-x-2 py-3" id="search-form">
    <div class="relative w-full">
        <input type="search" id="mensaje-query" name="q"
            class="block w-full p-4 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50
                   focus:ring-gray-500 focus:border-gray-500 dark:bg-gray-700 dark:border-gray-600 
                   dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
            placeholder="Buscar mensajes por nombre, correo o WhatsApp" value="{{ query }}" />
    </div>
    <button type="submit"
        class="text-white bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300
               font-medium rounded-lg text-sm px-3 py-2.5">
        Buscar
    </button>
</form>

<!-- Contenedor de los mensajes -->
<ul class="flex flex-col w-full justify-center items-center py-1" id="mensaje-list">
    {% for mensaje in pagina_actual %}
        <li class="flex w-full bg-white rounded-lg shadow p-4 my-2">
            <div class="flex flex-col w-full">
                <div class="flex justify-between items-center">
                    <p class="font-bold text-gray-700 text-sm">{{ mensaje.nombre_completo }}</p>
                    <span class="text-xs text-gray-500">{{ mensaje.fecha_creacion|date:"d/m/Y H:i" }}</span>
                </div>
                <div class="text-xs text-gray-600 mt-1">
                    <p><strong>WhatsApp:</strong> {{ mensaje.numero_whatsapp }}</p>
                    <p><strong>Correo:</strong> {{ mensaje.correo }}</p>
                    <p><strong>Mensaje:</strong> {{ mensaje.mensaje }}</p>
                </div>
                <div class="flex justify-end mt-2 gap-2">
                    {% if not mensaje.leido %}
                        <a href="{% url 'marcar_mensaje_leido' mensaje.id %}" 
                           class="px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600">
                            Marcar como leído
                        </a>
                    {% endif %}
                    <a href="{% url 'eliminar_mensaje' mensaje.id %}" 
                       class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">
                        Eliminar
                    </a>
                </div>
            </div>
        </li>
    {% empty %}
        <li class="text-gray-500 font-bold py-3">No hay mensajes disponibles.</li>
    {% endfor %}
</ul>

<!-- Paginación -->
{% if total_registros > 0 %}
<div class="flex w-full p-3 justify-center items-center">
    <nav aria-label="Paginación de mensajes">
        <ul class="inline-flex -space-x-px text-sm">
            {% if pagina_actual.has_previous %}
                <li>
                    <a href="?q={{ query }}&page={{ pagina_actual.previous_page_number }}"
                       class="flex items-center justify-center px-3 h-8 text-gray-700 bg-white border rounded-s-lg">
                        Anterior
                    </a>
                </li>
            {% else %}
                <li>
                    <span class="flex items-center justify-center px-3 h-8 text-gray-500 bg-white border rounded-s-lg">
                        Anterior
                    </span>
                </li>
            {% endif %}

            <li>
                <span class="flex items-center justify-center px-3 h-8 text-gray-500 border bg-white">
                    Página: {{ pagina_actual.number }}
                </span>
            </li>

            {% if pagina_actual.has_next %}
                <li>
                    <a href="?q={{ query }}&page={{ pagina_actual.next_page_number }}"
                       class="flex items-center justify-center px-3 h-8 text-gray-700 bg-white border rounded-e-lg">
                        Siguiente
                    </a>
                </li>
            {% else %}
                <li>
                    <span class="flex items-center justify-center px-3 h-8 text-gray-500 bg-white border rounded-e-lg">
                        Siguiente
                    </span>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endif %}

{% endblock content %}
